{
    "meta": {
        "analysis_scope": "L1_OnOffAxis + L1_SpeedMotor + L2_Positioning_DOL_Machine",
        "version": "3.0",
        "analysis_date": "2026-01-07",
        "physical_model": "Positioning system using Variable Speed Drive (Sinamics S120) + Encoder Feedback. 'Hybrid' architecture using discrete logic controller (OnOffAxis) driving an analog-style speed reference.",
        "key_features": [
            "Drive Control - Uses Sinamics S120 via TEL1 (SpeedMotor)",
            "Variable Speed - Dynamically selects Low/Med/High velocity based on distance",
            "Logic Split - OnOffAxis handles position evaluation, L2 FB handles speed generation",
            "Dynamic Deceleration - Drive ramp times used for smooth stop (unlike contactor slamming)",
            "Safety - STO handling integration",
            "Unit Transformation - Native conversion between Machine Units (Um1) and Display/Profile Units (Um2)"
        ]
    },
    "Unit_Transformation": {
        "description": "Linear transformation handling between Control Units (Um1) and Human Interface/Profile Units (Um2). Allows the HMI to work in a different unit (e.g. inches, degrees) than the logic.",
        "Definitions": {
            "Um1 (Unit 1)": "Primary/Machine Unit. The unit used by the logic, L1 controllers, and standard calculations (e.g. mm).",
            "Um2 (Unit 2)": "Secondary/Display Unit. The unit presented to the operator or defined in product recipes (e.g. inches)."
        },
        "Functions": {
            "Um1-2": {
                "Formula": "Um2 = (Um1 * m) + q",
                "Source_File": "Um1-2.scl",
                "Usage": "Displaying actual position data to HMI (COut.ActualPosition -> HMI.Sts.ActualPos_UM2)"
            },
            "Um2-1": {
                "Formula": "Um1 = (Um2 - q) / m",
                "Source_File": "Um2-1.scl",
                "Usage": "Converting setpoints from HMI/Recipe to logical values (HMI.PresetPosition -> Ax.AxisCtrl.HomePosition)"
            }
        },
        "Data_Type": {
            "Name": "udt_LinTranformation",
            "Fields": {
                "m": "Slope/Multiplier (Real)",
                "q": "Offset (Real)"
            }
        }
    },
    "L1_OnOffAxis": {
        "description": "Logic Controller for Positioning context. In DOL, it acts as the 'Distance State Machine', telling the L2 System *which* speed window applies, rather than driving contactors directly.",
        "source_file": "OnOffAxis.scl",
        "role_in_DOL": {
            "Input": "Position Feedback & Target",
            "Processing": "Evaluates distance to target against 'PreEnd' windows",
            "Outputs_Used": [
                "CmdLowSpeed",
                "CmdMediumSpeed",
                "CmdHighSpeed",
                "CmdMinus/CmdPlus (Direction)"
            ]
        },
        "Config": {
            "StandStillDelay": "Mapped to S120.DecTime (plus margin) to align logical standstill with physical drive ramp down",
            "PreEndMedSpeed": "Distance to start ramping down from High to Med",
            "PreEndLowSpeed": "Distance to start ramping down from Med to Low",
            "PreCutOff": "Distance to cut torque completely (final stop)"
        }
    },
    "L1_SpeedMotor": {
        "description": "Drive Wrapper for Sinamics S120 (TEL1). Receives velocity commands from the L2 logic.",
        "source_file": "SpeedMotor.scl",
        "role_in_DOL": {
            "Input": "Velocity Setpoint & Direction from L2 Logic",
            "Function": "Executes speed ramp, handles Infeed power, reports actual velocity/current",
            "Parameterization": "ReferenceVelocity used to scale % commands from L2"
        }
    },
    "L2_Positioning_DOL_Machine": {
        "description": "Aggregator L2 for Drive Open Loop Positioning. Bridges the discreet logic of OnOffAxis with the continuous control of SpeedMotor.",
        "structure": {
            "Ax": "L1_OnOffAxis instance (The Brain)",
            "S120": "L1_SpeedMotor instance (The Muscle)",
            "PosFeedback": "External interface (Encoder)"
        },
        "Velocity_Logic": {
            "description": "Converts OnOffAxis discrete speed flags into continuous S120 velocity setpoints",
            "Algorithm": [
                "IF Ax.CmdLowSpeed THEN Speed = Par.LowSpeed %",
                "ELSIF Ax.CmdMediumSpeed THEN Speed = Par.MedSpeed %",
                "ELSIF Ax.CmdHighSpeed THEN Speed = Par.HighSpeed %",
                "ELSE Speed = 0.0"
            ],
            "Overrides": [
                "Manual Override: Multiplied by CIn.Manager.Speed / 100",
                "Brake Hold: Force Speed 0.0 if Brake not released"
            ]
        },
        "Mapping": {
            "Direction": "Ax.CmdMinus -> S120.MoveMinus, Ax.CmdPlus -> S120.MovePlus",
            "Power": "CIn.Manager.Control_ON OR ExternalPowerOn -> S120.Power",
            "Safety": "AreaInterface.SafeStop -> S120.SafeStop"
        },
        "Config": {
            "Ax": "OnOffAxis Limits & Windows",
            "S120": "Drive Ramp times (Acc/Dec), Reference Velocity",
            "Fan": "Optional Motor Fan control features"
        },
        "Par": {
            "PosTolerance": "Positioning Window",
            "Low/Med/HighSpeed": "Velocity setpoints (%) for each zone",
            "PreEndLow/MedSpeed": "Distance thresholds for zone transition"
        },
        "Alarms": {
            "BrakeTimeOut": "Brake failed to release/engage",
            "S120_ComErr": "Profinet Communication lost",
            "S120": "Bubbled up Drive Faults",
            "Ax": "Bubbled up Positioning Logic Faults"
        },
        "PosFbk_Interface_and_Variants": {
            "description": "Uses standard PosFbk_ITF. See MOL machine or generic documentation for variants (Sick, Baumer, Analog, etc.)."
        }
    }
}